---
title: "Gov 50 Final Project"
author: "Sam Davidson"
description: "Comparing parental engagement between non-coresidential fathers of different marital statuses"
output:
  distill::distill_article:
    self_contained: false
---

# Introduction

My research question for this project was: Do non-coresidential fathers, fathers who do not live with their children, have different levels of engagement with their children based on their marriage status? The two marriage statuses that I was particularly interested in were fathers who were never married and fathers who were married and then divorced or annulled. My hypothesis was that fathers who were married and then divorced would have higher levels of engagement with their children because if they were in a marriage with their spouse that they had children with, then it seems like their level of engagement with their family overall would be higher than a father who was never married to his spouse. 

This research question is interesting to me because there are many aspects of society and law in the U.S. that emphasize the importance of the institution of marriage, particularly for family stability and the benefit of children. As a large percentage of marriages end in divorce and with marriage rates at historic lows, an interesting and common scenario to investigate is not the engagement of fathers who are still in marriages or still living with their children but fathers who are not. Is the emphasis on marriage justified by the outcomes for children of divorced parents or should the law encourage more non-traditional family structures that account for children outside of marriage. **maybe clarify this section on the stakes a little better

# Data

The data that I am pulling from is the [CDC's National Survey on Family Growth](https://www.cdc.gov/nchs/nsfg/index.htm). The survey collects data on both men and women and data is collected through continuous field interviews. The data that I am looking at specifically is just the data collected on men ages 15-44 from 2017 to 2019. This selection of data includes 5,206 men. 

```{r}
#Loading the Data and Packages
library(tidyverse)
library(infer)
men <- read_csv("data/csv_2017_2019_Male.csv")

#Cleaning the Data
#Filtering for only men who were never married or were divorced. 
#Coding a binary variable to represent those two marriage statuses
#Recoding age as a numeric value. 
div_nev_men <- men |> 
  filter(marstat == "Divorced or annulled" | marstat == "Never been married") |>  
  mutate(divorced_vs_never = case_when(marstat == "Divorced or annulled"~ 1, 
                                       marstat == "Never been married" ~ 0), 
         age_num = as.numeric(gsub("[^0-9]", "", AGE_A)))
```

To answer this question, I looked at two different dependent variables: number of visits and satisfaction with those visits. This is a cross-sectional study, as we are looking at two groups of survey respondents at one point in time.

While the survey reports many different metrics for parental engagement such as going on errands, accompanying children to appointments, showing physical affection, spending play time, reading books, and eating meals, the variable that seemed most logical to summarize these more objective metrics of engagement was number of visits per week. To measure the subjective experience of these fathers, the satisfaction with these visits made sense. I am examining the data collected only for fathers of children ages 0-4 (this limitation is explained in my conclusion). Below is the distribution of number of visits for both types of fathers:

```{r}

#Recoding the survey answers into numerical values for visits per week
visit04_1 <- div_nev_men |> 
  filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> 
  mutate(visit_bool_04_1 = case_when(NRVISIT04 == "Not at all" ~ 0, 
                                     NRVISIT04 == "Less than once a week" ~ 0.5, 
                                     NRVISIT04 == "About once a week" ~ 1, 
                                     NRVISIT04 == "Several times a week" ~ 3, 
                                     NRVISIT04 == "Every day (at least once a day)" ~ 7))

#Visualization of number of visits per week
visit04_1 |> 
  ggplot(aes(x=visit_bool_04_1)) + 
  geom_histogram(binwidth = 0.5, fill = "#004080") + 
  labs(title = "Distribution of visits per week, both types of non-coresidential fathers", 
       x = "Visits per Week", 
       y = "Count")
```
And here is the distribution for satisfaction of visits:


```{r}

#Cleaning the satisfaction variable, no arbitrary judgements had to be made however
satvis04 <- div_nev_men |> 
  filter(NRSATVIS04 != "Refused" & 
           NRSATVIS04 != "Don't know" & 
           NRSATVIS04 != "Not ascertained") |> 
  mutate(sat_adjust04 = case_when(NRSATVIS04 == "Very satisfied" ~ 10, 
                                  NRSATVIS04 == "Very dissatisfied" ~ 1, 
                                  TRUE ~ as.numeric(NRSATVIS04)))

satvis04 |> ggplot(aes(x=sat_adjust04)) + 
  geom_histogram(fill = "#004080", binwidth = 1) + 
  labs(title = "Distribution of satisfaction with visits, both types of non-coresidential fathers",
       x = "Satisfaction, rated 0-10",
       y = "Count") 

```


# Results

I first ran a regression with visits per week as the dependent variable and the marital status of the non-coresidential father as an independent binary variable. I've included age, race, and income into the regression as controls, but unfortunately that does make the output table annoyingly long.

```{r}
#Regression
regression_visit04_1 <- lm(visit_bool_04_1 ~ divorced_vs_never + 
                             age_num + 
                             race + 
                             totincr, 
                           data = visit04_1)

#Outputting the model
modelsummary::modelsummary(regression_visit04_1, statistic = 
                             c("s.e. = {std.error}",
                                         "p = {p.value}"), 
                           gof_map = c("nobs", "r.squared", "adj.r.squared"))
```

As it is a binary regression, the coefficient on our independent variable, divorced_vs_never, represents the difference in means of our dependent variable, visits per week, controlling for age, race, and income. According to the regression, the difference in the average value of visits per week between divorced fathers and never married fathers is -0.240. This means that divorced fathers see their kids 0.24 times per week less than never married fathers. However, the p-value for this regression is 0.733. This does not meet any threshold for statistical significance, and so we cannot take this difference in means to be statistically significant. There is thus nothing that we can really say about a significant average difference in visits for the two groups of father.**MENTION IN CONCLUSION ABOUT NOBS AND ADJUSTED R SQUARED**

One abritrary decision that I had to make when refactoring the survey answers into numerical measures of visits per week is how to assign a number to answers like "Less than once a week" or "Several times a week." The most arbitrary decision I felt was for the former, for answers of "Less than once a week" which I first assigned a value of 0.5 visits per week. I wanted to conduct a robustness test on this decision to see if assigning a different value would provide a different outcome in the regression:

```{r}
#Robustness testing


#Recoding the visit variable in five different ways
#Decreasing the value for "Less than once a week" by 0.1 each time
visit04_1 <- div_nev_men |> 
  filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> 
  mutate(visit_bool_04_1 = case_when(NRVISIT04 == "Not at all" ~ 0, 
                                     NRVISIT04 == "Less than once a week" ~ 0.5, 
                                     NRVISIT04 == "About once a week" ~ 1, 
                                     NRVISIT04 == "Several times a week" ~ 3, 
                                     NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_2 <- div_nev_men |> 
  filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> 
  mutate(visit_bool_04_2 = case_when(NRVISIT04 == "Not at all" ~ 0, 
                                     NRVISIT04 == "Less than once a week" ~ 0.4, 
                                     NRVISIT04 == "About once a week" ~ 1, 
                                     NRVISIT04 == "Several times a week" ~ 3, 
                                     NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_3 <- div_nev_men |> 
  filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> 
  mutate(visit_bool_04_3 = case_when(NRVISIT04 == "Not at all" ~ 0, 
                                     NRVISIT04 == "Less than once a week" ~ 0.3, 
                                     NRVISIT04 == "About once a week" ~ 1, 
                                     NRVISIT04 == "Several times a week" ~ 3, 
                                     NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_4 <- div_nev_men |> 
  filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> 
  mutate(visit_bool_04_4 = case_when(NRVISIT04 == "Not at all" ~ 0, 
                                     NRVISIT04 == "Less than once a week" ~ 0.2, 
                                     NRVISIT04 == "About once a week" ~ 1, 
                                     NRVISIT04 == "Several times a week" ~ 3, 
                                     NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_5 <- div_nev_men |> 
  filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> 
  mutate(visit_bool_04_5 = case_when(NRVISIT04 == "Not at all" ~ 0, 
                                     NRVISIT04 == "Less than once a week" ~ 0.1, 
                                     NRVISIT04 == "About once a week" ~ 1, 
                                     NRVISIT04 == "Several times a week" ~ 3, 
                                     NRVISIT04 == "Every day (at least once a day)" ~ 7))

#Running a regression for each of the different recodes
regression_visit04_1 <- lm(visit_bool_04_1 ~ divorced_vs_never + 
                             age_num + 
                             race + 
                             totincr, 
                           data = visit04_1)

regression_visit04_2 <- lm(visit_bool_04_2 ~ divorced_vs_never + 
                             age_num + 
                             race + 
                             totincr, 
                           data = visit04_2)

regression_visit04_3 <- lm(visit_bool_04_3 ~ divorced_vs_never + 
                             age_num + 
                             race + 
                             totincr, 
                           data = visit04_3)

regression_visit04_4 <- lm(visit_bool_04_4 ~ divorced_vs_never + 
                             age_num + 
                             race + 
                             totincr, 
                           data = visit04_4)

regression_visit04_5 <- lm(visit_bool_04_5 ~ divorced_vs_never + 
                             age_num + 
                             race + 
                             totincr, 
                           data = visit04_5)

#Adding the reported p-value from each regression into a list
coefficients <- summary(regression_visit04_1)$coefficients["divorced_vs_never", "Pr(>|t|)"]

coefficients <- append(coefficients, summary(regression_visit04_2)$
                         coefficients["divorced_vs_never", "Pr(>|t|)"])

coefficients <- append(coefficients, summary(regression_visit04_3)$
                         coefficients["divorced_vs_never", "Pr(>|t|)"])

coefficients <- append(coefficients, summary(regression_visit04_4)$
                         coefficients["divorced_vs_never", "Pr(>|t|)"])

coefficients <- append(coefficients, summary(regression_visit04_5)$
                         coefficients["divorced_vs_never", "Pr(>|t|)"])

#Also making a list of the different values set for "Less than once a week"
adjusted_values <- c(0.5, 0.4, 0.3, 0.2, 0.1)

#Making a tibble out of the two lists we just created
robustness_test <- tibble(coefficients, adjusted_values)

#Visualizing the test
robustness_test |> ggplot(aes(x=adjusted_values, y = coefficients)) + 
  geom_point(color = "#004080") + 
  labs(title = "Robustness Test For Recoding the Dependent Variable Visits per Week", 
       x = "Adjusted Numeric Value", 
       y = "P-Value of the Resulting Regression")


```
As we can see from the robustness test, adjusting the numerical values that correspond to "Less than once a week" does make a difference to the statistical significance, the most statistically significant difference came from  but it does not come close to a measure of statistical significance (even an alpha of 0.1)

The difference in number of visits between the two groups of fathers was thus ultimately statistically insignificant (further discussion in results below), but there is a statistically significant difference in the self-reported satisfaction with visits. Here is the regression for satisfaction with visits, controlling for age, race, and income:

```{r}
#Regression for satisfaction
#Using the previously calculated dependent variable sat_adjust04
regression_satvis04 <- lm(sat_adjust04 ~ divorced_vs_never + 
                            age_num + 
                            race + 
                            totincr, 
                          data = satvis04)

#Displaying the regression
modelsummary::modelsummary(regression_satvis04, 
                           statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), 
                           gof_map = c("nobs", "r.squared", "adj.r.squared"))

```

The coefficient on divorced_vs_never in this binary regression represents the difference in means of satisfaction with visits controlling for age, race, and income. According to the regression, the difference in the average reported satisfaction with visits between divorced fathers and never married fathers is -2.399. To interpret this substantively, divorced fathers are roughly two and a half points less satisfied with their visits (on a scale out of ten) than their never married counterparts. The p-value for this regression is 0.033. This meets the threshold for statistical significance with alpha = 0.05.

Without controls for age, race, and income, the regression (see below) has a statistical significance of 0.062, only meeting the threshold for statistical significance with an alpha of 0.1. The coefficient of divorced_vs_never, the average difference in means between the two groups, is also lower, -1.754 but is still in the same direction, with divorced fathers reporting less satisfaction than fathers who were never married. 

```{r}
#Regression without controls
regression_satvis04_no_controls <- lm(sat_adjust04 ~ divorced_vs_never, 
                          data = satvis04)

#Displaying the regression
modelsummary::modelsummary(regression_satvis04_no_controls, 
                           statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), 
                           gof_map = c("nobs", "r.squared", "adj.r.squared"))

```

Another way to visualize this difference, without controls for age, race, and income, is to look at a boxplot of the two types of fathers:

```{r}
#First recoding for a Divorced and Never Married category
visualize_satvis04 <- satvis04 |> mutate(div_stat = ifelse(divorced_vs_never == 1, "Divorced", "Never Married"))

#Then piping to a ggplot visualization
visualize_satvis04 |> ggplot(aes(x = div_stat, y = sat_adjust04)) + 
  geom_boxplot(fill = "#004080") + 
  labs(title = "Boxplot of Reported Satisfaction for the Two Groups of Fathers",
       x = "Marriage Status",
       y = "Reported Satisfaction")

```

Without controls for age, race, and income, we can also reject the null hypothesis of no difference in means by bootstrapping a confidence interval:


```{r}
#Generating 1000 bootstrapped samples
ate_satvis04 <- satvis04 |> 
  mutate(div_stat = ifelse(divorced_vs_never == 1, "Divorced", "Never Married")) |> 
  specify(sat_adjust04 ~ div_stat) |> 
  generate(reps = 1000, type = "bootstrap") |> 
  calculate(stat = "diff in means", 
            order = c("Divorced","Never Married"))

#Getting a 90% confidence interval from those samples
ate_satvis04_ci_90 <- ate_satvis04 |> 
  get_confidence_interval(level = 0.90, type = "percentile")

#Displaying the confidence interval
knitr::kable(ate_satvis04_ci_90, 
             col.names = c("Lower CI", "Upper CI"),
             digits = 2,
             align = 'c')

```
We can see that an ATE of 0 falls outside of a 90% confidence interval, which corresponds to an alpha of 0.1.

```{r}
#Getting a 95% confidence interval from those samples
ate_satvis04_ci_95 <- ate_satvis04 |> 
  get_confidence_interval(level = 0.95, type = "percentile")

#Displaying the confidence interval
knitr::kable(ate_satvis04_ci_95, 
             col.names = c("Lower CI", "Upper CI"),
             digits = 2,
             align = 'c')

```
An ATE of 0 does, however, fall within a 95% confidence interval, which corresponds to an alpha of 0.05. Still, however, the most interesting regression remains the regression with controls for age, race, and income, which shows statistical signficance with an alpha of 0.05.




#Running a Regression



```{r}
#Now running our analyses - so one thing to ask ourselves, what does the p-value of the model summary tell us? Is that for a hypothesis of no difference? ***ASK IN OFFICE HOURS

#Cleaning the data for only men who were never married or were divorced. Coding a binary variable to represent those two marriage statuses. 

div_nev_men <- men |> filter(marstat == "Divorced or annulled" | marstat == "Never been married") |>  mutate(divorced_vs_never = case_when(marstat == "Divorced or annulled"~ 1, marstat == "Never been married" ~ 0), age_num = as.numeric(gsub("[^0-9]", "", AGE_A)))

##NRVISIT04 - non-coresidential father visits per week, looking specifically at children aged 0-4.

#Cleaning the data here. Filtering for missing data in the visit answer and then recoding the survey responses into discrete values.

#Robustness testing

visit04_1 <- div_nev_men |> filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> mutate(visit_bool_04_1 = case_when(NRVISIT04 == "Not at all" ~ 0, NRVISIT04 == "Less than once a week" ~ 0.5, NRVISIT04 == "About once a week" ~ 1, NRVISIT04 == "Several times a week" ~ 3, NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_2 <- div_nev_men |> filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> mutate(visit_bool_04_2 = case_when(NRVISIT04 == "Not at all" ~ 0, NRVISIT04 == "Less than once a week" ~ 0.4, NRVISIT04 == "About once a week" ~ 1, NRVISIT04 == "Several times a week" ~ 3, NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_3 <- div_nev_men |> filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> mutate(visit_bool_04_3 = case_when(NRVISIT04 == "Not at all" ~ 0, NRVISIT04 == "Less than once a week" ~ 0.3, NRVISIT04 == "About once a week" ~ 1, NRVISIT04 == "Several times a week" ~ 3, NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_4 <- div_nev_men |> filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> mutate(visit_bool_04_4 = case_when(NRVISIT04 == "Not at all" ~ 0, NRVISIT04 == "Less than once a week" ~ 0.2, NRVISIT04 == "About once a week" ~ 1, NRVISIT04 == "Several times a week" ~ 3, NRVISIT04 == "Every day (at least once a day)" ~ 7))

visit04_5 <- div_nev_men |> filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> mutate(visit_bool_04_5 = case_when(NRVISIT04 == "Not at all" ~ 0, NRVISIT04 == "Less than once a week" ~ 0.1, NRVISIT04 == "About once a week" ~ 1, NRVISIT04 == "Several times a week" ~ 3, NRVISIT04 == "Every day (at least once a day)" ~ 7))

#Running a regression. Adding age, race, and income. 

regression_visit04_1 <- lm(visit_bool_04_1 ~ divorced_vs_never + age_num + race + totincr, data = visit04_1)
regression_visit04_2 <- lm(visit_bool_04_2 ~ divorced_vs_never + age_num + race + totincr, data = visit04_2)
regression_visit04_3 <- lm(visit_bool_04_3 ~ divorced_vs_never + age_num + race + totincr, data = visit04_3)

modelsummary::modelsummary(regression_visit04_1, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), gof_map = c("nobs", "r.squared", "adj.r.squared"))
modelsummary::modelsummary(regression_visit04_2, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), gof_map = c("nobs", "r.squared", "adj.r.squared"))
modelsummary::modelsummary(regression_visit04_3, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), gof_map = c("nobs", "r.squared", "adj.r.squared"))


```


```{r}

##NRVISIT518 - non-coresidential father visits per week, looking specifically at children aged 5-18.

visit518 <- div_nev_men |> filter(NRVISIT518 != "NA" & NRVISIT518 != "Not ascertained" & NRVISIT518 != "Don't know") |> mutate(visit_bool_518 = case_when(NRVISIT518 == "Not at all" ~ 0, NRVISIT518 == "Less than once a week" ~ 0.5, NRVISIT518 == "About once a week" ~ 1, NRVISIT518 == "Several times a week" ~ 3, NRVISIT518 == "Every day (at least once a day)" ~ 7))

regression_visit518 <- lm(visit_bool_518 ~ divorced_vs_never + age_num + race + totincr, data = visit518)

modelsummary::modelsummary(regression_visit518, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), gof_map = c("nobs", "r.squared", "adj.r.squared"))


##NRSATVIS04 - statistically significant P-value, very low R^2. Do some of the other things you know how to do like bootstrapping ATE and hypothesis testing. Maybe we're not supposed to get a high R^2 here. 

satvis04 <- div_nev_men |> filter(NRSATVIS04 != "Refused" & NRSATVIS04 != "Don't know" & NRSATVIS04 != "Not ascertained") |> mutate(sat_adjust04 = case_when(NRSATVIS04 == "Very satisfied" ~ 10, NRSATVIS04 == "Very dissatisfied" ~ 1, TRUE ~ as.numeric(NRSATVIS04)))

regression_satvis04 <- lm(sat_adjust04 ~ divorced_vs_never + age_num + race + totincr, data = satvis04)

modelsummary::modelsummary(regression_satvis04, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), gof_map = c("nobs", "r.squared", "adj.r.squared"))
ggplot(regression_satvis04, aes(x = divorced_vs_never, y = sat_adjust04)) + geom_point() + labs(title = "Regression")


#visualizing the dependent variable

satvis04 |> ggplot(aes(x=sat_adjust04)) + geom_histogram()

satvis04 |> filter(divorced_vs_never == 0) |> ggplot(aes(x=sat_adjust04)) + geom_histogram()
  
##NRSATVIS518

satvis518 <- div_nev_men |> filter(NRSATVIS518 != "Refused" & NRSATVIS518 != "Don't know" & NRSATVIS518 != "Not ascertained") |> mutate(sat_adjust518 = case_when(NRSATVIS518 == "Very satisfied" ~ 10, NRSATVIS518 == "Very dissatisfied" ~ 1, TRUE ~ as.numeric(NRSATVIS518)))

regression_satvis518 <- lm(sat_adjust518 ~ divorced_vs_never + age_num + race + totincr, data = satvis518)

modelsummary::modelsummary(regression_satvis518, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"), gof_map = c("nobs", "r.squared", "adj.r.squared"))

##Bootstrapping NRSATVIS04 - ok so it's significant with an alpha level of 0.1 but not 0.05. How do we control for stuff within a bootstrap? It becomes more significant if you control for more stuff. **And I am I supposed to do a bootstrap or a permute here? **And how do I visualize a regression? Can I make a boxplot with the two categories of fathers based on the regression with controls and if so, how? ##DO INDENTATIONS FOR EACH NEW PIPE

##So we get a different coefficient with the regression. Can show both of these. 

##Can still do a robustness test on the insignificance of visit04

real_ate_satvis04 <- satvis04 |> mutate(div_stat = ifelse(divorced_vs_never == 1, "Divorced", "Never Married")) |> specify(sat_adjust04 ~ div_stat) |> calculate(stat = "diff in means", order = c("Divorced","Never Married"))

satvis04 |> mutate(div_stat = ifelse(divorced_vs_never == 1, "Divorced", "Never Married")) |> group_by(div_stat) |> summarize(Mean_val = mean(sat_adjust04))

visualize_satvis04 <- satvis04 |> mutate(div_stat = ifelse(divorced_vs_never == 1, "Divorced", "Never Married"))

visualize_satvis04 |> ggplot(aes(x = div_stat, y = sat_adjust04)) + geom_boxplot()


ate_satvis04 <- satvis04 |> mutate(div_stat = ifelse(divorced_vs_never == 1, "Divorced", "Never Married")) |> specify(sat_adjust04 ~ div_stat) |> generate(reps = 1000, type = "bootstrap") |> calculate(stat = "diff in means", order = c("Divorced","Never Married"))

ate_satvis04_ci_90 <- ate_satvis04 |> get_confidence_interval(level = 0.90, type = "percentile")

ate_satvis04_ci_90

visualize(ate_satvis04)

ate_satvis04_se <- sd(ate_satvis04$stat)
ate_satvis04_se #0.983
#The s.e. on the no-controls regression is 0.930
#The s.e. on the regression with controls is 1.108. So that is one limitation of the model, the standard error increases and the adjusted R^2 decreases but the effect is larger and the p-value decreases. Overall I'd value the higher statistical significance more and so would point to the regression with controls as the most useful analysis here. 

```


# Milestone 4: Drilling down on one variable

For this analysis, I want to use one variable that tracks non-coresidential parental engagement, number of visits per week, to approximate overall how engaged different groups of fathers are. I'm assuming that this variable will be correlated to other engagement variables such as number of meals or going to appointments with children. I am going to be looking at two different groups of fathers in particular, fathers that are divorced and fathers that never married. What we can see from this data is that fathers of children ages 0-4 who are divorced see their kids, on average, about 0.22 days fewer per week than fathers who never married, but fathers of children ages 5-18 who are divorced see their kids, on average, about 0.19 days more per week than fathers who never married. The effect of marriage status is different depending on the ages of the non-coresidential children. 


```{r, echo=FALSE}
library(tidyverse)
men <- read_csv("data/csv_2017_2019_Male.csv")

#I would say my study is well motivated: we would think fathers who were divorced spend more time with their kids than fathers who were never married. 

#show that social desirability can affect people's answers because they want to seem like good fathers. The worry is the baseline had more variability, but because it's all scaled up the variance is harder to detect because the data is skewed up. "Social desirability bias made the results more muted than we might expect" 0.5 and 1 vs 4.5 and 5. Does this source of bias make my results less plausible or more plausible?

#show that missing data is a threat to your ability to say causal. 

visit_04 <- men |> filter(NRVISIT04 != "NA" & NRVISIT04 != "Not ascertained") |> mutate(visit_bool_04 = case_when(NRVISIT04 == "Not at all" ~ 0, NRVISIT04 == "Less than once a week" ~ 0.5, NRVISIT04 == "About once a week" ~ 1, NRVISIT04 == "Several times a week" ~ 3, NRVISIT04 == "Every day (at least once a day)" ~ 7))
visit_518 <- men |> filter(NRVISIT518 != "NA" & NRVISIT518 != "Not ascertained" & NRVISIT518 != "Don't know") |> mutate(visit_bool_518 = case_when(NRVISIT518 == "Not at all" ~ 0, NRVISIT518 == "Less than once a week" ~ 0.5, NRVISIT518 == "About once a week" ~ 1, NRVISIT518 == "Several times a week" ~ 3, NRVISIT518 == "Every day (at least once a day)" ~ 7))

#just explain what you're doing with these numbers. Maybe then assign different numbers like 0.1, 0.2, 0.3, 0.6 and re-run the analysis - robustness check. Plot the robustness check - show how the beta hat of your regression changes 

#say how big your sample size is. Show their demographics. can you use survey weights in the lm function? Weights column in the lm function. Showed weighted vs unweighted. 



ate_marriage_status_04 <- visit_04 |> group_by(marstat) |> summarize(avg_visits_04 = mean(visit_bool_04)) |> filter(marstat == "Divorced or annulled" | marstat == "Never been married")

ate_marriage_status_518 <- visit_518 |> group_by(marstat) |> summarize(avg_visits_518 = mean(visit_bool_518)) |> filter(marstat == "Divorced or annulled" | marstat == "Never been married")

ate_mar_total <- left_join(ate_marriage_status_04, ate_marriage_status_518)

knitr::kable(ate_mar_total, col.names = c("Marriage Status", "Average Visits per Week (age 0-4)", "Average Visits per Week (age 5-18)"), digits = 2, align = "c")

#ifelse for divorced and never married. Put both into a regression. Should be mutually exclusive. Could do two separate regressions for visits 0-4 and visits 5-18 or combine them. But better to separate them. Potentially look at demographic differences as confounders between the two groups. Just say "holding constant" these demographic differences. Include all potential confounders in one regression along with the explanatory variables. If we were able to hold constant all of those other demographics, this is what the average effect of divorce status is going to be. Will get a p-value from the regression. Discuss causal and substantive significance. One causal concern is not including enough confounders. 

#Could run a regression for these other things like errands, appointments. Just change the outcome variable, don't add into the regression as a control because it's not pre-treatment. Could help us understand the quality of these father-child relationships not just the quantity. 

#Make sure you don't drop too many observations because of NA - just pick the most well-responded confounders like age, race, income. 

#REGRESSION STUFF

visit_04 <- visit_04 |> filter(marstat == "Divorced or annulled" | marstat == "Never been married") |> mutate(divorced = ifelse(marstat == "Divorced or annulled", 1, 0), never_married = ifelse(marstat == "Never been married", 1, 0))

visit_04 <- visit_04 |> filter(marstat == "Divorced or annulled" | marstat == "Never been married") |> mutate(divorced_vs_never = case_when(marstat == "Divorced or annulled"~ 1, marstat == "Never been married" ~ 0))

regression_04 <- lm(visit_bool_04 ~ divorced_vs_never, data = visit_04)

summary(regression_04)
#visit_518 <- visit_518 |> mutate(is_divorced = ifelse(marstat == "Divorced or annulled", 1, 0), never_married = ifelse(marstat == "Never been married", 1, 0))

visit_518 <- visit_518 |> mutate(divorced_vs_never = case_when(marstat == "Divorced or annulled"~ 1, marstat == "Never been married" ~ 0))

#regression_518_beta <- lm(visit_bool_518 ~ is_divorced + never_married, data = visit_518)
regression_518 <- lm(visit_bool_518 ~ divorced_vs_never, data = visit_518)
summary(regression_518) #this shows the difference between the two groups is not statistically significant. Can still run the robustness test. Add the other variables. Is the difference between the two groups more than statistically 0, the p-value is high. We cannot really reject the null that the difference is 0. 
#summary(regression_518_beta) #this one says is the effect 0? So yes very low p-value

#did get a very significant p-value with the other way to do visit_518.



```


# Milestone 3: Data Visualization

```{r fig.height = 5, fig.width = 15, echo=FALSE}
library(tidyverse)
men <- read_csv("data/csv_2017_2019_Male.csv")

men |> filter(ncall != "none") |> group_by(marstat) |> summarize(cur_mar = n()) |> ggplot(aes(y=marstat, x=cur_mar)) + geom_col() + labs(title = "Distribution of current marriage status among fathers reporting at least 1 non-coresidential child", x = "Count", y = "Marriage Status")

```
# Data Source

My dataset is the CDC's National Survey of Family Growth (NSFG), conducted between 2017 and 2019. The specific data I'm looking at is an independent sample of men aged 15-49. 

# Research Question

I am interested in looking at non-coresidential father involvement in their children's lives, I want to then see how different factors such as educational attainment, income, and former marital status impacts that involvement. I will have to aggregate several different measures of child involvement present in the survey in order to have one single dependent variable. 

# Hypothesis

I think that non-coresidential fathers who were previously married would be more involved in their children's lives than fathers who were never married, because they would potentially have a closer or better relationship with their ex. I am interested in seeing if this effect is different across different income spectrums, however. 

# Variable Notes

CDC codebook on fathering: https://www.cdc.gov/nchs/data/nsfg/2017-2019_NSFG_Male_SectionG_Codebook-508.pdf

Variables of interest for coresidential focal child: (pages 1-12)
- ROUTG04: In the last four weeks, how often did you
Spend time with [NAME OF CORESIDENTIAL FOCAL CHILD] on an outing away from home to places such as
museums, zoos, movies, sports, playground, park, etc.?
- RMEAL04: (In the last four weeks, how often did you... )
Eat evening meals together with [NAME OF CORESIDENTIAL FOCAL CHILD]?
- And also: RERRAND04, RPLAY04, RREAD04, RAFFECT04, RPRAISE04, RFEED04,RBATH04, RDIAPER04, RBED04, RAPPT04
- And those variables ending in 518, which signifies a coresidential focal child between 5-18 years of age. 

For non-residential focal child:
- NRVISIT04, NRSATVIS04, NROUTG04, etc. (pages 13-24)
- NRVISITG518, etc.

Codebook on Former Wives and First Cohabiting Partner: https://www.cdc.gov/nchs/data/nsfg/2017-2019_NSFG_Male_SectionE_Codebook-508.pdf

Never married variable: nformwife

Other interesting:
- How did the marriage end: MARREND4 (first former wife) --> MARREND7 (fourth former wife)
- #CASEID - this is how you can individually identify each person

Complications:
- There are overlaps between non-coresidential and coresidential fathers. 
- There are not just never married or divorced non-coresidential fathers. There are also fathers who are still married - the challenge is to disaggregate 


